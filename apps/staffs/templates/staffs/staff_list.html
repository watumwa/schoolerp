{% extends 'base.html' %}

{% block title %}STAFF/TEACHERS{% endblock title %}

{% block breadcrumb %}
<a class="btn btn-primary" href="{% url 'staff-create' %}"><i class="fas fa-plus"></i> New staff</a>
{% endblock breadcrumb %}

{% block content %}
  <table id="stafftable" class="table table-bordered table-hover">
    <thead class="thead-light">
      <tr>
        <th>S/N</th>
        <th>Fullname</th>
        <th>Gender</th>
        <th>Phone Number</th>
        <th>Status</th>
        <th>Class Taught</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for staff in object_list %}
        <tr>
          <td>{{ forloop.counter}}</td>
          <td>{{ staff.surname}} {{staff.firstname }} {{staff.other_name }}</td>
          <td>{{ staff.get_gender_display}}</td>
          <td>{{ staff.mobile_number}}</td>
          <td>{{ staff.get_current_status_display}}</td>
          <td>{{staff.class_taught}}</td>
          <td>
            <a href="{% url 'staff-detail' staff.id %}" class="btn btn-info btn-sm">View</a>
            <a href="{% url 'staff-update' staff.id %}" class="btn btn-warning btn-sm">Edit</a>
            <button class="btn btn-danger btn-sm" onclick="deleteStaff({{ staff.id }})">Delete</button>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock content %}

{% block morejs %}
<script>
   $('#stafftable').DataTable({
    select: false
   });

   function deleteStaff(staffId) {
     if (confirm('Are you sure you want to delete this staff member?')) {
       const deleteUrl = `{% url 'staff-delete' 0 %}`.replace('0', staffId);
       fetch(deleteUrl, {
         method: 'DELETE',
         headers: {
           'X-CSRFToken': '{{ csrf_token }}'
         }
       })
       .then(response => {
         if (response.ok) {
           alert('Staff member deleted successfully');
           location.reload();
         } else {
           alert('Staff member deleted successfully');
         }
       })
       .catch(error => {
         console.error('Error:', error);
         alert('An error occurred while deleting the staff member');
       });
     }
   }
</script>
{% endblock morejs %}
